spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    url: ${DB_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driverClassName: org.mariadb.jdbc.Driver
  jpa:
    properties:
      hibernate:
        show_sql: true

  flyway:
    enabled: false
    locations: classpath:db/migration
    baseline-on-migrate: true
    clean-disabled: true

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=10000,expireAfterAccess=600s,recordStats
    cache-names:
      - job-validates
      - job-pricings
      - job-drop-off-etas


stuart:
  api:
    auth-url: https://api.sandbox.stuart.com/oauth/token
    job:
      create-url: https://api.sandbox.stuart.com/v2/jobs
      validate-url: https://api.sandbox.stuart.com/v2/jobs/validate
      pricing-url: https://api.sandbox.stuart.com/v2/jobs/pricing
      pickup-eta-url: https://api.sandbox.stuart.com/v2/jobs/eta
      dropoff-eta-url: https://api.sandbox.stuart.com/v2/jobs/cpt
      cancellation-url: https://api.sandbox.stuart.com/v2/jobs/{jobId}/cancel
      read-url: https://api.sandbox.stuart.com/v2/jobs/{jobId}
    client:
      id: ${API_CLIENT_ID:x50_jY2VvMiarhNHiBlgQazYb68aR5xMrfdSw7aC0E0}
      secret: ${API_CLIENT_SECRET:Dm_RB42m9SAc6jarok5UwJt2f3EwkmbTLkViFQoc3YY}

# Optional: Health check endpoint
management:
  endpoints:
    web:
      exposure:
        include: health,metrics
  health:
    token:
      enabled: true

app:
  cache:
    # Memory allocation (percentage of heap)
    max-heap-percentage: 0.35

    # Cache-specific configurations
    caches:
      job-validates:
        max-size: 20000
        ttl: 120                # 2 minutes
        record-stats: true
        soft-values: false

      job-pricings:
        max-size: 20000
        ttl: 120              # 2 minutes
        record-stats: true
        expire-after-access: true

      job-drop-off-etas:
        max-size: 20000
        ttl: 120              # 2 minutes
        record-stats: true
        expire-after-access: true

    # Eviction settings
    eviction:
      policy: size-based         # size-based or time-based
      cleanup-delay: 1000        # milliseconds between cleanup runs

    # Monitoring
    monitoring:
      enabled: true
      stats-log-interval: 300    # seconds
      alert-hit-rate-threshold: 0.7  # Alert if hit rate drops below 70%
      alert-eviction-threshold: 1000 # Alert if evictions > 1000/min

  delivery-charge:
    added-amount: 3

logPath: /opt/delivery-gateway/logs